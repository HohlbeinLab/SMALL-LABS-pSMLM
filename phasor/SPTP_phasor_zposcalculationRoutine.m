function zposlist = SPTP_phasor_zposcalculationRoutine(distX, distY, curveX, curveY)
%% Calculation of z positions from calibration data and distance in X,Y
%Required input: distX, distY: arrays with distance in X,Y
%               curveX, curveY: calibration curves in X,Y (SPTP_phasor_calibrationRoutine output)

%First remove values if they're not larger than their counterpart (i.e. X
%larger than Y or viceversa)
distXorig = distX;
distYorig = distY;
distX(distXorig<distYorig) = 0;
distY(distYorig<distXorig) = 0;
%also make boolean list of distX/distY - if they have a value, get 1,
%otherwise 0.
distXboolean = zeros(size(distX));
distXboolean(distX>0) = 1;
distYboolean = zeros(size(distY));
distYboolean(distY>0) = 1;
%now calculate zpos from these values. Solve 4th order polynomial for this

as = curveY.Coefficients{1,1};
bs = curveY.Coefficients{2,1};
cs = curveY.Coefficients{3,1};
ds = curveY.Coefficients{4,1};
es = curveY.Coefficients{5,1};
ys = distY; %the big switcharoo in X/Y
zpos_distX = (3.*6.^(1./2).*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).*(27.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2 + 2.*(bs./es - (3.*as.^2)./(8.*es.^2)).^3 - 72.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)) + 3.*3.^(1./2).*(27.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^4 + 128.*(bs./es - (3.*as.^2)./(8.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^2 - 256.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^3 + 4.*(bs./es - (3.*as.^2)./(8.*es.^2)).^3.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2 - 16.*(bs./es - (3.*as.^2)./(8.*es.^2)).^4.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)) - 144.*(bs./es - (3.*as.^2)./(8.*es.^2)).*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2))).^(1./2)).^(1./2) - 12.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).*((bs./es - (3.*as.^2)./(8.*es.^2)).^2 + (12.*(ds - ys))./es + 9.*((cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2./2 + (bs./es - (3.*as.^2)./(8.*es.^2)).^3./27 - (4.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)))./3 + (3.^(1./2).*(27.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^4 + 128.*(bs./es - (3.*as.^2)./(8.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^2 - 256.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^3 + 4.*(bs./es - (3.*as.^2)./(8.*es.^2)).^3.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2 - 16.*(bs./es - (3.*as.^2)./(8.*es.^2)).^4.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)) - 144.*(bs./es - (3.*as.^2)./(8.*es.^2)).*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2))).^(1./2))./18).^(2./3) - (9.*as.^4)./(64.*es.^4) - 6.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2./2 + (bs./es - (3.*as.^2)./(8.*es.^2)).^3./27 - (4.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)))./3 + (3.^(1./2).*(27.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^4 + 128.*(bs./es - (3.*as.^2)./(8.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^2 - 256.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^3 + 4.*(bs./es - (3.*as.^2)./(8.*es.^2)).^3.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2 - 16.*(bs./es - (3.*as.^2)./(8.*es.^2)).^4.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)) - 144.*(bs./es - (3.*as.^2)./(8.*es.^2)).*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2))).^(1./2))./18).^(1./3) + (3.*as.^2.*bs)./(4.*es.^3) - (3.*as.*cs)./es.^2).^(1./2) - 9.*((cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2./2 + (bs./es - (3.*as.^2)./(8.*es.^2)).^3./27 - (4.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)))./3 + (3.^(1./2).*(27.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^4 + 128.*(bs./es - (3.*as.^2)./(8.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^2 - 256.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^3 + 4.*(bs./es - (3.*as.^2)./(8.*es.^2)).^3.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2 - 16.*(bs./es - (3.*as.^2)./(8.*es.^2)).^4.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)) - 144.*(bs./es - (3.*as.^2)./(8.*es.^2)).*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2))).^(1./2))./18).^(2./3).*((bs./es - (3.*as.^2)./(8.*es.^2)).^2 + (12.*(ds - ys))./es + 9.*((cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2./2 + (bs./es - (3.*as.^2)./(8.*es.^2)).^3./27 - (4.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)))./3 + (3.^(1./2).*(27.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^4 + 128.*(bs./es - (3.*as.^2)./(8.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^2 - 256.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^3 + 4.*(bs./es - (3.*as.^2)./(8.*es.^2)).^3.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2 - 16.*(bs./es - (3.*as.^2)./(8.*es.^2)).^4.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)) - 144.*(bs./es - (3.*as.^2)./(8.*es.^2)).*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2))).^(1./2))./18).^(2./3) - (9.*as.^4)./(64.*es.^4) - 6.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2./2 + (bs./es - (3.*as.^2)./(8.*es.^2)).^3./27 - (4.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)))./3 + (3.^(1./2).*(27.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^4 + 128.*(bs./es - (3.*as.^2)./(8.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^2 - 256.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^3 + 4.*(bs./es - (3.*as.^2)./(8.*es.^2)).^3.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2 - 16.*(bs./es - (3.*as.^2)./(8.*es.^2)).^4.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)) - 144.*(bs./es - (3.*as.^2)./(8.*es.^2)).*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2))).^(1./2))./18).^(1./3) + (3.*as.^2.*bs)./(4.*es.^3) - (3.*as.*cs)./es.^2).^(1./2) - (bs./es - (3.*as.^2)./(8.*es.^2)).^2.*((bs./es - (3.*as.^2)./(8.*es.^2)).^2 + (12.*(ds - ys))./es + 9.*((cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2./2 + (bs./es - (3.*as.^2)./(8.*es.^2)).^3./27 - (4.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)))./3 + (3.^(1./2).*(27.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^4 + 128.*(bs./es - (3.*as.^2)./(8.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^2 - 256.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^3 + 4.*(bs./es - (3.*as.^2)./(8.*es.^2)).^3.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2 - 16.*(bs./es - (3.*as.^2)./(8.*es.^2)).^4.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)) - 144.*(bs./es - (3.*as.^2)./(8.*es.^2)).*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2))).^(1./2))./18).^(2./3) - (9.*as.^4)./(64.*es.^4) - 6.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2./2 + (bs./es - (3.*as.^2)./(8.*es.^2)).^3./27 - (4.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)))./3 + (3.^(1./2).*(27.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^4 + 128.*(bs./es - (3.*as.^2)./(8.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^2 - 256.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^3 + 4.*(bs./es - (3.*as.^2)./(8.*es.^2)).^3.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2 - 16.*(bs./es - (3.*as.^2)./(8.*es.^2)).^4.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)) - 144.*(bs./es - (3.*as.^2)./(8.*es.^2)).*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2))).^(1./2))./18).^(1./3) + (3.*as.^2.*bs)./(4.*es.^3) - (3.*as.*cs)./es.^2).^(1./2) - 12.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2./2 + (bs./es - (3.*as.^2)./(8.*es.^2)).^3./27 - (4.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)))./3 + (3.^(1./2).*(27.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^4 + 128.*(bs./es - (3.*as.^2)./(8.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^2 - 256.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^3 + 4.*(bs./es - (3.*as.^2)./(8.*es.^2)).^3.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2 - 16.*(bs./es - (3.*as.^2)./(8.*es.^2)).^4.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)) - 144.*(bs./es - (3.*as.^2)./(8.*es.^2)).*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2))).^(1./2))./18).^(1./3).*((bs./es - (3.*as.^2)./(8.*es.^2)).^2 + (12.*(ds - ys))./es + 9.*((cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2./2 + (bs./es - (3.*as.^2)./(8.*es.^2)).^3./27 - (4.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)))./3 + (3.^(1./2).*(27.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^4 + 128.*(bs./es - (3.*as.^2)./(8.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^2 - 256.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^3 + 4.*(bs./es - (3.*as.^2)./(8.*es.^2)).^3.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2 - 16.*(bs./es - (3.*as.^2)./(8.*es.^2)).^4.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)) - 144.*(bs./es - (3.*as.^2)./(8.*es.^2)).*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2))).^(1./2))./18).^(2./3) - (9.*as.^4)./(64.*es.^4) - 6.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2./2 + (bs./es - (3.*as.^2)./(8.*es.^2)).^3./27 - (4.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)))./3 + (3.^(1./2).*(27.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^4 + 128.*(bs./es - (3.*as.^2)./(8.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^2 - 256.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^3 + 4.*(bs./es - (3.*as.^2)./(8.*es.^2)).^3.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2 - 16.*(bs./es - (3.*as.^2)./(8.*es.^2)).^4.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)) - 144.*(bs./es - (3.*as.^2)./(8.*es.^2)).*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2))).^(1./2))./18).^(1./3) + (3.*as.^2.*bs)./(4.*es.^3) - (3.*as.*cs)./es.^2).^(1./2)).^(1./2)./(6.*((cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2./2 + (bs./es - (3.*as.^2)./(8.*es.^2)).^3./27 - (4.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)))./3 + (3.^(1./2).*(27.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^4 + 128.*(bs./es - (3.*as.^2)./(8.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^2 - 256.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^3 + 4.*(bs./es - (3.*as.^2)./(8.*es.^2)).^3.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2 - 16.*(bs./es - (3.*as.^2)./(8.*es.^2)).^4.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)) - 144.*(bs./es - (3.*as.^2)./(8.*es.^2)).*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2))).^(1./2))./18).^(1./6).*((bs./es - (3.*as.^2)./(8.*es.^2)).^2 + (12.*(ds - ys))./es + 9.*((cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2./2 + (bs./es - (3.*as.^2)./(8.*es.^2)).^3./27 - (4.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)))./3 + (3.^(1./2).*(27.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^4 + 128.*(bs./es - (3.*as.^2)./(8.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^2 - 256.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^3 + 4.*(bs./es - (3.*as.^2)./(8.*es.^2)).^3.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2 - 16.*(bs./es - (3.*as.^2)./(8.*es.^2)).^4.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)) - 144.*(bs./es - (3.*as.^2)./(8.*es.^2)).*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2))).^(1./2))./18).^(2./3) - (9.*as.^4)./(64.*es.^4) - 6.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2./2 + (bs./es - (3.*as.^2)./(8.*es.^2)).^3./27 - (4.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)))./3 + (3.^(1./2).*(27.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^4 + 128.*(bs./es - (3.*as.^2)./(8.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^2 - 256.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^3 + 4.*(bs./es - (3.*as.^2)./(8.*es.^2)).^3.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2 - 16.*(bs./es - (3.*as.^2)./(8.*es.^2)).^4.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)) - 144.*(bs./es - (3.*as.^2)./(8.*es.^2)).*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2))).^(1./2))./18).^(1./3) + (3.*as.^2.*bs)./(4.*es.^3) - (3.*as.*cs)./es.^2).^(1./4)) - ((bs./es - (3.*as.^2)./(8.*es.^2)).^2 + (12.*(ds - ys))./es + 9.*((cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2./2 + (bs./es - (3.*as.^2)./(8.*es.^2)).^3./27 - (4.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)))./3 + (3.^(1./2).*(27.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^4 + 128.*(bs./es - (3.*as.^2)./(8.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^2 - 256.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^3 + 4.*(bs./es - (3.*as.^2)./(8.*es.^2)).^3.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2 - 16.*(bs./es - (3.*as.^2)./(8.*es.^2)).^4.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)) - 144.*(bs./es - (3.*as.^2)./(8.*es.^2)).*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2))).^(1./2))./18).^(2./3) - (9.*as.^4)./(64.*es.^4) - 6.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2./2 + (bs./es - (3.*as.^2)./(8.*es.^2)).^3./27 - (4.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)))./3 + (3.^(1./2).*(27.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^4 + 128.*(bs./es - (3.*as.^2)./(8.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^2 - 256.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^3 + 4.*(bs./es - (3.*as.^2)./(8.*es.^2)).^3.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2 - 16.*(bs./es - (3.*as.^2)./(8.*es.^2)).^4.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)) - 144.*(bs./es - (3.*as.^2)./(8.*es.^2)).*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2))).^(1./2))./18).^(1./3) + (3.*as.^2.*bs)./(4.*es.^3) - (3.*as.*cs)./es.^2).^(1./2)./(6.*((cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2./2 + (bs./es - (3.*as.^2)./(8.*es.^2)).^3./27 - (4.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)))./3 + (3.^(1./2).*(27.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^4 + 128.*(bs./es - (3.*as.^2)./(8.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^2 - 256.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^3 + 4.*(bs./es - (3.*as.^2)./(8.*es.^2)).^3.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2 - 16.*(bs./es - (3.*as.^2)./(8.*es.^2)).^4.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)) - 144.*(bs./es - (3.*as.^2)./(8.*es.^2)).*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2))).^(1./2))./18).^(1./6)) - as./(4.*es);

as = curveX.Coefficients{1,1};
bs = curveX.Coefficients{2,1};
cs = curveX.Coefficients{3,1};
ds = curveX.Coefficients{4,1};
es = curveX.Coefficients{5,1};
ys = distX;%the big switcharoo in X/Y
zpos_distY = ((bs./es - (3.*as.^2)./(8.*es.^2)).^2 + (12.*(ds - ys))./es + 9.*((cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2./2 + (bs./es - (3.*as.^2)./(8.*es.^2)).^3./27 - (4.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)))./3 + (3.^(1./2).*(27.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^4 + 128.*(bs./es - (3.*as.^2)./(8.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^2 - 256.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^3 + 4.*(bs./es - (3.*as.^2)./(8.*es.^2)).^3.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2 - 16.*(bs./es - (3.*as.^2)./(8.*es.^2)).^4.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)) - 144.*(bs./es - (3.*as.^2)./(8.*es.^2)).*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2))).^(1./2))./18).^(2./3) - (9.*as.^4)./(64.*es.^4) - 6.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2./2 + (bs./es - (3.*as.^2)./(8.*es.^2)).^3./27 - (4.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)))./3 + (3.^(1./2).*(27.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^4 + 128.*(bs./es - (3.*as.^2)./(8.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^2 - 256.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^3 + 4.*(bs./es - (3.*as.^2)./(8.*es.^2)).^3.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2 - 16.*(bs./es - (3.*as.^2)./(8.*es.^2)).^4.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)) - 144.*(bs./es - (3.*as.^2)./(8.*es.^2)).*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2))).^(1./2))./18).^(1./3) + (3.*as.^2.*bs)./(4.*es.^3) - (3.*as.*cs)./es.^2).^(1./2)./(6.*((cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2./2 + (bs./es - (3.*as.^2)./(8.*es.^2)).^3./27 - (4.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)))./3 + (3.^(1./2).*(27.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^4 + 128.*(bs./es - (3.*as.^2)./(8.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^2 - 256.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^3 + 4.*(bs./es - (3.*as.^2)./(8.*es.^2)).^3.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2 - 16.*(bs./es - (3.*as.^2)./(8.*es.^2)).^4.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)) - 144.*(bs./es - (3.*as.^2)./(8.*es.^2)).*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2))).^(1./2))./18).^(1./6)) - as./(4.*es) - (- (bs./es - (3.*as.^2)./(8.*es.^2)).^2.*((bs./es - (3.*as.^2)./(8.*es.^2)).^2 + (12.*(ds - ys))./es + 9.*((cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2./2 + (bs./es - (3.*as.^2)./(8.*es.^2)).^3./27 - (4.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)))./3 + (3.^(1./2).*(27.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^4 + 128.*(bs./es - (3.*as.^2)./(8.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^2 - 256.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^3 + 4.*(bs./es - (3.*as.^2)./(8.*es.^2)).^3.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2 - 16.*(bs./es - (3.*as.^2)./(8.*es.^2)).^4.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)) - 144.*(bs./es - (3.*as.^2)./(8.*es.^2)).*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2))).^(1./2))./18).^(2./3) - (9.*as.^4)./(64.*es.^4) - 6.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2./2 + (bs./es - (3.*as.^2)./(8.*es.^2)).^3./27 - (4.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)))./3 + (3.^(1./2).*(27.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^4 + 128.*(bs./es - (3.*as.^2)./(8.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^2 - 256.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^3 + 4.*(bs./es - (3.*as.^2)./(8.*es.^2)).^3.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2 - 16.*(bs./es - (3.*as.^2)./(8.*es.^2)).^4.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)) - 144.*(bs./es - (3.*as.^2)./(8.*es.^2)).*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2))).^(1./2))./18).^(1./3) + (3.*as.^2.*bs)./(4.*es.^3) - (3.*as.*cs)./es.^2).^(1./2) - 12.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).*((bs./es - (3.*as.^2)./(8.*es.^2)).^2 + (12.*(ds - ys))./es + 9.*((cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2./2 + (bs./es - (3.*as.^2)./(8.*es.^2)).^3./27 - (4.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)))./3 + (3.^(1./2).*(27.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^4 + 128.*(bs./es - (3.*as.^2)./(8.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^2 - 256.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^3 + 4.*(bs./es - (3.*as.^2)./(8.*es.^2)).^3.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2 - 16.*(bs./es - (3.*as.^2)./(8.*es.^2)).^4.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)) - 144.*(bs./es - (3.*as.^2)./(8.*es.^2)).*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2))).^(1./2))./18).^(2./3) - (9.*as.^4)./(64.*es.^4) - 6.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2./2 + (bs./es - (3.*as.^2)./(8.*es.^2)).^3./27 - (4.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)))./3 + (3.^(1./2).*(27.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^4 + 128.*(bs./es - (3.*as.^2)./(8.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^2 - 256.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^3 + 4.*(bs./es - (3.*as.^2)./(8.*es.^2)).^3.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2 - 16.*(bs./es - (3.*as.^2)./(8.*es.^2)).^4.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)) - 144.*(bs./es - (3.*as.^2)./(8.*es.^2)).*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2))).^(1./2))./18).^(1./3) + (3.*as.^2.*bs)./(4.*es.^3) - (3.*as.*cs)./es.^2).^(1./2) - 9.*((cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2./2 + (bs./es - (3.*as.^2)./(8.*es.^2)).^3./27 - (4.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)))./3 + (3.^(1./2).*(27.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^4 + 128.*(bs./es - (3.*as.^2)./(8.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^2 - 256.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^3 + 4.*(bs./es - (3.*as.^2)./(8.*es.^2)).^3.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2 - 16.*(bs./es - (3.*as.^2)./(8.*es.^2)).^4.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)) - 144.*(bs./es - (3.*as.^2)./(8.*es.^2)).*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2))).^(1./2))./18).^(2./3).*((bs./es - (3.*as.^2)./(8.*es.^2)).^2 + (12.*(ds - ys))./es + 9.*((cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2./2 + (bs./es - (3.*as.^2)./(8.*es.^2)).^3./27 - (4.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)))./3 + (3.^(1./2).*(27.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^4 + 128.*(bs./es - (3.*as.^2)./(8.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^2 - 256.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^3 + 4.*(bs./es - (3.*as.^2)./(8.*es.^2)).^3.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2 - 16.*(bs./es - (3.*as.^2)./(8.*es.^2)).^4.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)) - 144.*(bs./es - (3.*as.^2)./(8.*es.^2)).*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2))).^(1./2))./18).^(2./3) - (9.*as.^4)./(64.*es.^4) - 6.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2./2 + (bs./es - (3.*as.^2)./(8.*es.^2)).^3./27 - (4.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)))./3 + (3.^(1./2).*(27.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^4 + 128.*(bs./es - (3.*as.^2)./(8.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^2 - 256.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^3 + 4.*(bs./es - (3.*as.^2)./(8.*es.^2)).^3.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2 - 16.*(bs./es - (3.*as.^2)./(8.*es.^2)).^4.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)) - 144.*(bs./es - (3.*as.^2)./(8.*es.^2)).*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2))).^(1./2))./18).^(1./3) + (3.*as.^2.*bs)./(4.*es.^3) - (3.*as.*cs)./es.^2).^(1./2) - 3.*6.^(1./2).*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).*(27.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2 + 2.*(bs./es - (3.*as.^2)./(8.*es.^2)).^3 - 72.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)) + 3.*3.^(1./2).*(27.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^4 + 128.*(bs./es - (3.*as.^2)./(8.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^2 - 256.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^3 + 4.*(bs./es - (3.*as.^2)./(8.*es.^2)).^3.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2 - 16.*(bs./es - (3.*as.^2)./(8.*es.^2)).^4.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)) - 144.*(bs./es - (3.*as.^2)./(8.*es.^2)).*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2))).^(1./2)).^(1./2) - 12.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2./2 + (bs./es - (3.*as.^2)./(8.*es.^2)).^3./27 - (4.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)))./3 + (3.^(1./2).*(27.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^4 + 128.*(bs./es - (3.*as.^2)./(8.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^2 - 256.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^3 + 4.*(bs./es - (3.*as.^2)./(8.*es.^2)).^3.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2 - 16.*(bs./es - (3.*as.^2)./(8.*es.^2)).^4.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)) - 144.*(bs./es - (3.*as.^2)./(8.*es.^2)).*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2))).^(1./2))./18).^(1./3).*((bs./es - (3.*as.^2)./(8.*es.^2)).^2 + (12.*(ds - ys))./es + 9.*((cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2./2 + (bs./es - (3.*as.^2)./(8.*es.^2)).^3./27 - (4.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)))./3 + (3.^(1./2).*(27.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^4 + 128.*(bs./es - (3.*as.^2)./(8.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^2 - 256.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^3 + 4.*(bs./es - (3.*as.^2)./(8.*es.^2)).^3.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2 - 16.*(bs./es - (3.*as.^2)./(8.*es.^2)).^4.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)) - 144.*(bs./es - (3.*as.^2)./(8.*es.^2)).*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2))).^(1./2))./18).^(2./3) - (9.*as.^4)./(64.*es.^4) - 6.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2./2 + (bs./es - (3.*as.^2)./(8.*es.^2)).^3./27 - (4.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)))./3 + (3.^(1./2).*(27.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^4 + 128.*(bs./es - (3.*as.^2)./(8.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^2 - 256.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^3 + 4.*(bs./es - (3.*as.^2)./(8.*es.^2)).^3.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2 - 16.*(bs./es - (3.*as.^2)./(8.*es.^2)).^4.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)) - 144.*(bs./es - (3.*as.^2)./(8.*es.^2)).*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2))).^(1./2))./18).^(1./3) + (3.*as.^2.*bs)./(4.*es.^3) - (3.*as.*cs)./es.^2).^(1./2)).^(1./2)./(6.*((cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2./2 + (bs./es - (3.*as.^2)./(8.*es.^2)).^3./27 - (4.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)))./3 + (3.^(1./2).*(27.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^4 + 128.*(bs./es - (3.*as.^2)./(8.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^2 - 256.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^3 + 4.*(bs./es - (3.*as.^2)./(8.*es.^2)).^3.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2 - 16.*(bs./es - (3.*as.^2)./(8.*es.^2)).^4.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)) - 144.*(bs./es - (3.*as.^2)./(8.*es.^2)).*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2))).^(1./2))./18).^(1./6).*((bs./es - (3.*as.^2)./(8.*es.^2)).^2 + (12.*(ds - ys))./es + 9.*((cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2./2 + (bs./es - (3.*as.^2)./(8.*es.^2)).^3./27 - (4.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)))./3 + (3.^(1./2).*(27.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^4 + 128.*(bs./es - (3.*as.^2)./(8.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^2 - 256.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^3 + 4.*(bs./es - (3.*as.^2)./(8.*es.^2)).^3.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2 - 16.*(bs./es - (3.*as.^2)./(8.*es.^2)).^4.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)) - 144.*(bs./es - (3.*as.^2)./(8.*es.^2)).*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2))).^(1./2))./18).^(2./3) - (9.*as.^4)./(64.*es.^4) - 6.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2./2 + (bs./es - (3.*as.^2)./(8.*es.^2)).^3./27 - (4.*(bs./es - (3.*as.^2)./(8.*es.^2)).*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)))./3 + (3.^(1./2).*(27.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^4 + 128.*(bs./es - (3.*as.^2)./(8.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^2 - 256.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)).^3 + 4.*(bs./es - (3.*as.^2)./(8.*es.^2)).^3.*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2 - 16.*(bs./es - (3.*as.^2)./(8.*es.^2)).^4.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2)) - 144.*(bs./es - (3.*as.^2)./(8.*es.^2)).*(cs./es + as.^3./(8.*es.^3) - (as.*bs)./(2.*es.^2)).^2.*((ds - ys)./es - (3.*as.^4)./(256.*es.^4) + (as.^2.*bs)./(16.*es.^3) - (as.*cs)./(4.*es.^2))).^(1./2))./18).^(1./3) + (3.*as.^2.*bs)./(4.*es.^3) - (3.*as.*cs)./es.^2).^(1./4));
 
%Third-order polynomial kept for backup
%now calculate zpos from these values. Solve 3rd order polynomial for this
% a = curveX.Coefficients{1,1};
% b = curveX.Coefficients{2,1};
% c = curveX.Coefficients{3,1};
% d = curveX.Coefficients{4,1};
% y = distX;
% zpos_distX = (sqrt((-27.*a.^2.*d + 27.*a.^2.*y + 9.*a.*b.*c - 2.*b.^3).^2 + 4.*(3.*a.*c - b.^2).^3) - 27.*a.^2.*d + ...
%     27.*a.^2.*y + 9.*a.*b.*c - 2.*b.^3).^(1./3)./(3.*2.^(1./3).*a) - (2.^(1./3).*(3.*a.*c - b.^2))./...
%     (3.*a.*(sqrt((-27.*a.^2.*d + 27.*a.^2.*y + 9.*a.*b.*c - 2.*b.^3).^2 + 4.*(3.*a.*c - b.^2).^3) - ...
%     27.*a.^2.*d + 27.*a.^2.*y + 9.*a.*b.*c - 2.*b.^3).^(1./3)) - b./(3.*a);
% a = curveY.Coefficients{1,1};
% b = curveY.Coefficients{2,1};
% c = curveY.Coefficients{3,1};
% d = curveY.Coefficients{4,1};
% y = distY;
% zpos_distY = (sqrt((-27.*a.^2.*d + 27.*a.^2.*y + 9.*a.*b.*c - 2.*b.^3).^2 + 4.*(3.*a.*c - b.^2).^3) - 27.*a.^2.*d + ...
%     27.*a.^2.*y + 9.*a.*b.*c - 2.*b.^3).^(1./3)./(3.*2.^(1./3).*a) - (2.^(1./3).*(3.*a.*c - b.^2))./...
%     (3.*a.*(sqrt((-27.*a.^2.*d + 27.*a.^2.*y + 9.*a.*b.*c - 2.*b.^3).^2 + 4.*(3.*a.*c - b.^2).^3) - ...
%     27.*a.^2.*d + 27.*a.^2.*y + 9.*a.*b.*c - 2.*b.^3).^(1./3)) - b./(3.*a);

zposlist = zpos_distX;
zposlist(distX>distY) = zpos_distY(distX>distY); %also Y/X switcaroo'd
zposlist = real(zposlist);
        
% zposlist = distXboolean.*zpos_distX+distYboolean.*zpos_distY;

end